# í…ŒìŠ¤íŠ¸ ì‹ ë¢°ì„± ë¶„ì„ ë³´ê³ ì„œ

## ğŸ” ì‹ ë¢°ì„± ë¬¸ì œê°€ ìˆëŠ” í…ŒìŠ¤íŠ¸ë“¤

### 1. ê³¼ë„í•œ ëª¨í‚¹ìœ¼ë¡œ ì¸í•œ ë”ë¯¸ í…ŒìŠ¤íŠ¸ (ê°œì„  í•„ìš”)

#### 1.1 ë¸”ë¡ ë””ë°”ì´ìŠ¤ ì •ë³´ ì¡°íšŒ í…ŒìŠ¤íŠ¸
**ë¬¸ì œ**: `blkid`, `lsblk` ë“±ì˜ ëª…ë ¹ì–´ë¥¼ ëª¨í‚¹í•˜ì—¬ ê°€ì§œ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸
**í˜„ì¬ ìƒíƒœ**: 
```bash
# tests/test_helpers.bash - mock_blkid()
mock_blkid() {
    case "$device" in
        "/dev/sda"|"/dev/sda1")
            echo "UUID=\"12345678-1234-1234-1234-123456781234\" TYPE=\"ext4\""
            ;;
    esac
}
```

**ê°œì„  ë°©ì•ˆ**: ì‹¤ì œ ì‹œìŠ¤í…œì˜ ë¸”ë¡ ë””ë°”ì´ìŠ¤ ì •ë³´ ì‚¬ìš©
```bash
# ê°œì„ ëœ ì ‘ê·¼ë²•
@test "ì‹¤ì œ ë¸”ë¡ ë””ë°”ì´ìŠ¤ ì •ë³´ íŒŒì‹±" {
    # ì‹¤ì œ lsblk ì¶œë ¥ ì‚¬ìš© (ì‹œìŠ¤í…œì— ìµœì†Œ 1ê°œ ë””ìŠ¤í¬ëŠ” ì¡´ì¬)
    run lsblk -J
    assert_command_success
    
    # JSON íŒŒì‹± ë¡œì§ í…ŒìŠ¤íŠ¸
    local output="$output"
    run parse_lsblk_json "$output"
    assert_command_success
}
```

#### 1.2 fstab íŒŒì¼ ì¡°ì‘ í…ŒìŠ¤íŠ¸
**ë¬¸ì œ**: ì‹¤ì œ íŒŒì¼ ì¡°ì‘ ëŒ€ì‹  ëª¨í‚¹ëœ í™˜ê²½ì—ì„œë§Œ í…ŒìŠ¤íŠ¸
**í˜„ì¬ ìƒíƒœ**: `TEST_FSTAB_FILE` ì‚¬ìš©ì€ ì¢‹ì§€ë§Œ, ì¼ë¶€ í•¨ìˆ˜ëŠ” ëª¨í‚¹ì— ì˜ì¡´

**ê°œì„  ë°©ì•ˆ**: ì™„ì „í•œ ì„ì‹œ íŒŒì¼ ê¸°ë°˜ í…ŒìŠ¤íŠ¸
```bash
@test "fstab í•­ëª© ì¶”ê°€ - ì‹¤ì œ íŒŒì¼ ì¡°ì‘" {
    local temp_fstab="${TEST_TEMP_DIR}/test_fstab"
    cat > "$temp_fstab" << 'EOF'
UUID=existing-uuid / ext4 defaults 0 1
EOF
    
    # ì‹¤ì œ íŒŒì¼ ì¡°ì‘ í…ŒìŠ¤íŠ¸
    FSTAB_FILE="$temp_fstab" run add_fstab_entry "UUID=new-uuid" "/data" "ext4" "defaults" "0" "2"
    assert_command_success
    
    # ê²°ê³¼ ê²€ì¦
    run grep "UUID=new-uuid" "$temp_fstab"
    assert_command_success
    assert_output_contains "/data"
}
```

### 2. ì¬í˜„ ë¶ˆê°€ëŠ¥í•œ í…ŒìŠ¤íŠ¸ (ëª¨í‚¹ì´ ì •ë‹¹í™”ë¨)

#### 2.1 RAID í•˜ë“œì›¨ì–´ ì‹œë®¬ë ˆì´ì…˜
**ì •ë‹¹í•œ ëª¨í‚¹**: ì‹¤ì œ RAID ìƒì„±ì€ í•˜ë“œì›¨ì–´ í•„ìš”, ë°ì´í„° ì†ì‹¤ ìœ„í—˜
```bash
# ì´ëŸ° ê²½ìš°ëŠ” ëª¨í‚¹ì´ ì ì ˆí•¨
mock_mdadm() {
    case "$1" in
        "--create")
            echo "mdadm: array /dev/md0 started."
            ;;
        "--detail")
            echo "Version : 1.2"
            echo "Raid Level : raid1"
            ;;
    esac
}
```

#### 2.2 ë””ìŠ¤í¬ ì†ìƒ ì‹œë®¬ë ˆì´ì…˜
**ì •ë‹¹í•œ ëª¨í‚¹**: SMART ì˜¤ë¥˜, ë””ìŠ¤í¬ ì‹¤íŒ¨ ìƒí™©ì€ ì‹¤ì œë¡œ ì¬í˜„í•˜ê¸° ì–´ë ¤ì›€
```bash
# ì´ëŸ° ê²½ìš°ë„ ëª¨í‚¹ì´ ì ì ˆí•¨
mock_smartctl() {
    if [[ "$device" == "/dev/failing-disk" ]]; then
        echo "SMART Health Status: FAILING_NOW"
        return 1
    fi
}
```

## ğŸ”§ ê°œì„  ê³„íš

### Phase 1: ì„ì‹œ íŒŒì¼ ê¸°ë°˜ í…ŒìŠ¤íŠ¸ë¡œ ì „í™˜
1. **fstab ê´€ë ¨ í…ŒìŠ¤íŠ¸**: ëª¨ë“  fstab í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤ì œ ì„ì‹œ íŒŒì¼ ê¸°ë°˜ìœ¼ë¡œ ë³€ê²½
2. **ì„¤ì • íŒŒì¼ í…ŒìŠ¤íŠ¸**: config íŒŒì¼ ì¡°ì‘ í…ŒìŠ¤íŠ¸ë„ ì„ì‹œ íŒŒì¼ ì‚¬ìš©
3. **ë¡œê·¸ íŒŒì¼ í…ŒìŠ¤íŠ¸**: ë¡œê·¸ ìƒì„±/íŒŒì‹± í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤ì œ ì„ì‹œ íŒŒì¼ë¡œ

### Phase 2: ì‹¤ì œ ì‹œìŠ¤í…œ ëª…ë ¹ì–´ í™œìš©
1. **ë¸”ë¡ ë””ë°”ì´ìŠ¤ ì¡°íšŒ**: ì‹¤ì œ `lsblk`, `blkid` ì¶œë ¥ì„ íŒŒì‹±í•˜ëŠ” í…ŒìŠ¤íŠ¸
2. **íŒŒì¼ì‹œìŠ¤í…œ ì •ë³´**: ì‹¤ì œ `/proc/mounts`, `/proc/filesystems` ì½ê¸°
3. **ì‹œìŠ¤í…œ ì •ë³´**: ì‹¤ì œ `uname`, `free` ë“± ì‹œìŠ¤í…œ ëª…ë ¹ì–´ ì‚¬ìš©

### Phase 3: ìƒŒë“œë°•ìŠ¤ í™˜ê²½ êµ¬ì¶•
1. **ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™œìš©**: mount namespaceë¥¼ ì´ìš©í•œ ê²©ë¦¬ëœ ë§ˆìš´íŠ¸ í…ŒìŠ¤íŠ¸
2. **ë£¨í”„ë°± ë””ë°”ì´ìŠ¤**: ì‹¤ì œ íŒŒì¼ì‹œìŠ¤í…œ ìƒì„±/ë§ˆìš´íŠ¸ í…ŒìŠ¤íŠ¸
3. **ì»¨í…Œì´ë„ˆ í™˜ê²½**: Docker/LXCë¥¼ ì´ìš©í•œ ì™„ì „ ê²©ë¦¬ í…ŒìŠ¤íŠ¸

## ğŸ“Š ìš°ì„ ìˆœìœ„

### ğŸš¨ ì¦‰ì‹œ ê°œì„  í•„ìš” (High Priority)
1. **fstab íŒŒì¼ ì¡°ì‘ í…ŒìŠ¤íŠ¸**: 100% ì„ì‹œ íŒŒì¼ ê¸°ë°˜ìœ¼ë¡œ ì „í™˜
2. **ì„¤ì • íŒŒì¼ íŒŒì‹± í…ŒìŠ¤íŠ¸**: ì‹¤ì œ íŒŒì¼ ì½ê¸°/ì“°ê¸°ë¡œ ì „í™˜
3. **blkid/lsblk íŒŒì‹± í…ŒìŠ¤íŠ¸**: ì‹¤ì œ ëª…ë ¹ì–´ ì¶œë ¥ íŒŒì‹±ìœ¼ë¡œ ì „í™˜

### ğŸ”„ ì ì§„ì  ê°œì„  (Medium Priority)
1. **ë””ìŠ¤í¬ ì •ë³´ ì¡°íšŒ í…ŒìŠ¤íŠ¸**: ì¼ë¶€ ëª¨í‚¹ ì œê±°, ì‹¤ì œ ì‹œìŠ¤í…œ ì •ë³´ í™œìš©
2. **ë§ˆìš´íŠ¸ ìƒíƒœ í™•ì¸ í…ŒìŠ¤íŠ¸**: ì‹¤ì œ `/proc/mounts` íŒŒì‹±
3. **ì‹œìŠ¤í…œ í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸**: ì‹¤ì œ `/etc/os-release`, ì»¤ë„ ì •ë³´ ì‚¬ìš©

### ğŸ¯ ì¥ê¸° ëª©í‘œ (Low Priority)
1. **RAID í…ŒìŠ¤íŠ¸ ìƒŒë“œë°•ìŠ¤**: ë£¨í”„ë°± ë””ë°”ì´ìŠ¤ë¥¼ ì´ìš©í•œ ì‹¤ì œ RAID í…ŒìŠ¤íŠ¸
2. **ë§ˆìš´íŠ¸ í…ŒìŠ¤íŠ¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤**: ê²©ë¦¬ëœ í™˜ê²½ì—ì„œ ì‹¤ì œ ë§ˆìš´íŠ¸ í…ŒìŠ¤íŠ¸
3. **ì„±ëŠ¥ í…ŒìŠ¤íŠ¸**: ì‹¤ì œ I/O ì„±ëŠ¥ ì¸¡ì • í…ŒìŠ¤íŠ¸

## ğŸ› ï¸ êµ¬ì²´ì  ê°œì„  ì‚¬í•­

### setup ëª…ë ¹ì–´ ì˜ì¡´ì„± ê²€ì‚¬ ê°•í™”
í˜„ì¬ `install/install-deps.sh`ê°€ ì¡´ì¬í•˜ì§€ë§Œ, ë‹¤ìŒ ê°œì„  í•„ìš”:

1. **ëˆ„ë½ëœ íŒ¨í‚¤ì§€**:
   - `ruby`, `ruby-dev` (bashcov ì˜ì¡´ì„±)
   - `curl`, `wget` (ë‹¤ìš´ë¡œë“œ ë„êµ¬)
   - `git` (ë²„ì „ ê´€ë¦¬)

2. **ì„¤ì¹˜ í›„ ê²€ì¦**:
```bash
# ì„¤ì¹˜ í›„ ê° ë„êµ¬ì˜ ì‹¤ì œ ì‘ë™ í™•ì¸
verify_installation() {
    echo "ì„¤ì¹˜ ê²€ì¦ ì¤‘..."
    lsblk --version || exit 1
    mdadm --version || exit 1
    smartctl --version || exit 1
    # bashcov ê²€ì¦
    bashcov --version || echo "âš ï¸ bashcov ì„¤ì¹˜ í•„ìš”"
}
```

3. **í…ŒìŠ¤íŠ¸ í™˜ê²½ ê²€ì¦**:
```bash
# í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì „ í™˜ê²½ ê²€ì¦
verify_test_environment() {
    [[ -w /tmp ]] || { echo "âŒ /tmp ì“°ê¸° ê¶Œí•œ ì—†ìŒ"; exit 1; }
    command -v bats || { echo "âŒ bats ì„¤ì¹˜ í•„ìš”"; exit 1; }
    [[ -d /proc ]] || { echo "âŒ /proc íŒŒì¼ì‹œìŠ¤í…œ ì—†ìŒ"; exit 1; }
}
``` 